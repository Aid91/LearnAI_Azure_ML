{"version":"NotebookV1","origId":4078960254879083,"name":"env_setup","language":"python","commands":[{"version":"CommandV1","origId":4078960254879084,"guid":"82205d0c-1be3-40f7-98f0-30efb6c03cac","subtype":"command","commandType":"auto","position":1.0,"command":"%scala\nval tags = com.databricks.logging.AttributionContext.current.tags\n\n//*******************************************\n// GET VERSION OF APACHE SPARK\n//*******************************************\n\n// Get the version of spark\nval Array(sparkMajorVersion, sparkMinorVersion, _) = spark.version.split(\"\"\"\\.\"\"\")\n\n// Set the major and minor versions\nspark.conf.set(\"com.databricks.training.spark.major-version\", sparkMajorVersion)\nspark.conf.set(\"com.databricks.training.spark.minor-version\", sparkMinorVersion)\n\n//*******************************************\n// GET VERSION OF DATABRICKS RUNTIME\n//*******************************************\n\n// Get the version of the Databricks Runtime\nval runtimeVersion = tags.collect({ case (t, v) if t.name == \"sparkVersion\" => v }).head\nval runtimeVersions = runtimeVersion.split(\"\"\"-\"\"\")\nval (dbrVersion, scalaVersion) = if (runtimeVersions.size == 3) {\n  val Array(dbrVersion, _, scalaVersion) = runtimeVersions\n  (dbrVersion, scalaVersion.replace(\"scala\", \"\"))\n} else {\n  val Array(dbrVersion, scalaVersion) = runtimeVersions\n  (dbrVersion, scalaVersion.replace(\"scala\", \"\"))\n}\nval Array(dbrMajorVersion, dbrMinorVersion, _) = dbrVersion.split(\"\"\"\\.\"\"\")\n\n// Set the the major and minor versions\nspark.conf.set(\"com.databricks.training.dbr.major-version\", dbrMajorVersion)\nspark.conf.set(\"com.databricks.training.dbr.minor-version\", dbrMinorVersion)\n\n//*******************************************\n// GET USERNAME AND USERHOME\n//*******************************************\n\n// Get the user's name\nval username = tags.getOrElse(com.databricks.logging.BaseTagDefinitions.TAG_USER, java.util.UUID.randomUUID.toString.replace(\"-\", \"\"))\n\n// Get the user's home. Create it if necessary\nval userhome = s\"dbfs:/user/$username\"\n// This call doesn't fail if it already exists\nval created = dbutils.fs.mkdirs(userhome)\n\n// Set the user's name and home directory\nspark.conf.set(\"com.databricks.training.username\", username)\nspark.conf.set(\"com.databricks.training.userhome\", userhome)\n\n//**********************************\n// VARIOUS UTILITY FUNCTIONS\n//**********************************\n\ndef assertSparkVersion(expMajor:Int, expMinor:Int):String = {\n  val major = spark.conf.get(\"com.databricks.training.spark.major-version\")\n  val minor = spark.conf.get(\"com.databricks.training.spark.minor-version\")\n\n  if ((major.toInt < expMajor) || (major.toInt == expMajor && minor.toInt < expMinor))\n    throw new IllegalArgumentException(s\"This notebook must be ran on Spark version $expMajor.$expMinor or better, found Spark $major.$minor\")\n\n  s\"$major.$minor\"\n}\n\ndef requireDbrVersion(version:String):Unit = {\n  val major = spark.conf.get(\"com.databricks.training.dbr.major-version\")\n  val minor = spark.conf.get(\"com.databricks.training.dbr.minor-version\")\n  val dbrVersion = major+\".\"+minor\n  \n  if (version != dbrVersion) {\n    throw new IllegalArgumentException(s\"This notebook must be ran on Databricks Runtime (DBR) $version version, found DBR $dbrVersion.\")\n  }\n}\n\ndef assertDbrVersion(expMajor:Int, expMinor:Int):String = {\n  val major = spark.conf.get(\"com.databricks.training.dbr.major-version\")\n  val minor = spark.conf.get(\"com.databricks.training.dbr.minor-version\")\n\n  if ((major.toInt < expMajor) || (major.toInt == expMajor && minor.toInt < expMinor))\n    throw new IllegalArgumentException(s\"This notebook must be ran on Databricks Runtime (DBR) version $expMajor.$expMinor or better, found DBR $major.$minor.\")\n  \n  s\"$major.$minor\"\n}\n\ndisplayHTML(s\"\"\"\n  <div>Successfully created class variables and utility functions.</div>\n  <li><b>username</b>: $username</li>\n  <li><b>userhome</b>: $userhome</li>\n\"\"\")","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ce0e922e-bcd4-490b-86ff-635da9c343b4"},{"version":"CommandV1","origId":4078960254879085,"guid":"4bdf3813-c5a9-4ad1-982e-56c39530d947","subtype":"command","commandType":"auto","position":2.0,"command":"%python\n\nfrom __future__ import print_function\nfrom __future__ import division\n\n#**********************************\n# VARIOUS UTILITY FUNCTIONS\n#**********************************\n\ndef assertSparkVersion(expMajor, expMinor):\n  major = spark.conf.get(\"com.databricks.training.spark.major-version\")\n  minor = spark.conf.get(\"com.databricks.training.spark.minor-version\")\n\n  if (int(major) < expMajor) or (int(major) == expMajor and int(minor) < expMinor):\n    msg = \"This notebook must run on Spark version {}.{} or better, found.\".format(expMajor, expMinor, major, minor)\n    raise Exception(msg)\n\n  return major+\".\"+minor\n\ndef assertDbrVersion(expMajor, expMinor):\n  major = spark.conf.get(\"com.databricks.training.dbr.major-version\")\n  minor = spark.conf.get(\"com.databricks.training.dbr.minor-version\")\n\n  if (int(major) < expMajor) or (int(major) == expMajor and int(minor) < expMinor):\n    msg = \"This notebook must run on Databricks Runtime (DBR) version {}.{} or better, found.\".format(expMajor, expMinor, major, minor)\n    raise Exception(msg)\n    \n  return major+\".\"+minor\n\n#**********************************\n# INIT VARIOUS VARIABLES\n#**********************************\n\nusername = spark.conf.get(\"com.databricks.training.username\")\nuserhome = spark.conf.get(\"com.databricks.training.userhome\")\n\nimport sys\npythonVersion = spark.conf.set(\"com.databricks.training.python-version\", sys.version[0:sys.version.index(\" \")])\n\nNone # suppress output","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b2c2a873-4b79-4043-988c-46292a75c2a3"}],"dashboards":[],"guid":"4264a30b-0cad-495c-b190-3eac7baa1d82","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}