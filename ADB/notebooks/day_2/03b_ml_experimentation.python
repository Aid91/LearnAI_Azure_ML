{"version":"NotebookV1","origId":3771102850753995,"name":"03b_ml_experimentation","language":"python","commands":[{"version":"CommandV1","origId":3771102850753996,"guid":"e9be13cc-76b6-4555-ba89-7ddab693c051","subtype":"command","commandType":"auto","position":1.0,"command":"%md Copyright (c) Microsoft Corporation. All rights reserved.\n\nLicensed under the MIT License.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"2ca848e7-aa8a-4080-bb9c-6caa1c2dd3c8"},{"version":"CommandV1","origId":3771102850753998,"guid":"a6752a03-9fdc-4ea1-a90c-23d26351e60c","subtype":"command","commandType":"auto","position":3.0,"command":"%md #Model Building","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"0040463a-1607-4e30-bb9f-c177d93e2ff5"},{"version":"CommandV1","origId":3771102850753999,"guid":"707ca182-496f-49fe-9416-d93e32a8dbe2","subtype":"command","commandType":"auto","position":4.0,"command":"import os\nimport pprint\nimport numpy as np\n\nfrom pyspark.ml import Pipeline, PipelineModel\nfrom pyspark.ml.feature import OneHotEncoder, StringIndexer, VectorAssembler\nfrom pyspark.ml.classification import LogisticRegression\nfrom pyspark.ml.evaluation import BinaryClassificationEvaluator\nfrom pyspark.ml.tuning import CrossValidator, ParamGridBuilder","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228189532,"submitTime":1547228189531,"finishTime":1547228189598,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6d16f1e6-4ff8-4e29-a36a-f206b89d9d22"},{"version":"CommandV1","origId":3771102850754000,"guid":"cb07995e-55d8-4705-bc27-ec5d6d706057","subtype":"command","commandType":"auto","position":5.0,"command":"import azureml.core\n\n# Check core SDK version number\nprint(\"SDK version:\", azureml.core.VERSION)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">SDK version: 1.0.6\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228189891,"submitTime":1547228189884,"finishTime":1547228190520,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cc9dce44-f9da-411b-8737-59cf33774451"},{"version":"CommandV1","origId":3771102850754001,"guid":"63d4d945-9a7e-4709-bf24-fccdd1abcecc","subtype":"command","commandType":"auto","position":6.0,"command":"# import the Workspace class and check the azureml SDK version\nfrom azureml.core import Workspace\n\nconfig_path = '/dbfs/tmp/'\n\nws = Workspace.from_config(path=os.path.join(config_path, 'aml_config','config.json'))\nprint('Workspace name: ' + ws.name, \n      'Azure region: ' + ws.location, \n      'Subscription id: ' + ws.subscription_id, \n      'Resource group: ' + ws.resource_group, sep = '\\n')","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Found the config file in: /dbfs/tmp/aml_config/config.json\nPerforming interactive authentication. Please follow the instructions on the terminal.\nTo sign in, use a web browser to open the page https://microsoft.com/devicelogin and enter the code BUV4A8E6U to authenticate.\nInteractive authentication successfully completed.\nWorkspace name: myADBworkspace\nAzure region: westus2\nSubscription id: 5be49961-ea44-42ec-8021-b728be90d58c\nResource group: learnai_ai_airlift\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228190935,"submitTime":1547228190920,"finishTime":1547228209748,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6ccd8fcd-0e3e-4be4-8169-27e7084a5ab0"},{"version":"CommandV1","origId":3771102850754003,"guid":"3b24c661-7bb7-428e-9b22-112447b5add2","subtype":"command","commandType":"auto","position":8.0,"command":"train = train.drop(\"y_2\", \"y_3\", \"y_4\")\ntrain = train.withColumnRenamed(\"y_1\", \"error\")\ntrain.cache()\n\ntest = test.drop(\"y_2\", \"y_3\", \"y_4\")\ntest = test.withColumnRenamed(\"y_1\", \"error\")\ntest.cache()\n\nprint(\"train: ({}, {})\".format(train.count(), len(train.columns)))\nprint(\"test: ({}, {})\".format(test.count(), len(test.columns)))\n\ntrain.printSchema()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">train: (218200, 40)\ntest: (62600, 40)\nroot\n |-- volt_ma_3: double (nullable = true)\n |-- rotate_ma_3: double (nullable = true)\n |-- pressure_ma_3: double (nullable = true)\n |-- vibration_ma_3: double (nullable = true)\n |-- volt_sd_3: double (nullable = true)\n |-- rotate_sd_3: double (nullable = true)\n |-- pressure_sd_3: double (nullable = true)\n |-- vibration_sd_3: double (nullable = true)\n |-- volt_ma_12: double (nullable = true)\n |-- rotate_ma_12: double (nullable = true)\n |-- pressure_ma_12: double (nullable = true)\n |-- vibration_ma_12: double (nullable = true)\n |-- volt_sd_12: double (nullable = true)\n |-- rotate_sd_12: double (nullable = true)\n |-- pressure_sd_12: double (nullable = true)\n |-- vibration_sd_12: double (nullable = true)\n |-- e_1: double (nullable = true)\n |-- e_2: double (nullable = true)\n |-- e_3: double (nullable = true)\n |-- e_4: double (nullable = true)\n |-- e_5: double (nullable = true)\n |-- de_1: double (nullable = true)\n |-- de_2: double (nullable = true)\n |-- de_3: double (nullable = true)\n |-- de_4: double (nullable = true)\n |-- de_5: double (nullable = true)\n |-- m_1: double (nullable = true)\n |-- m_2: double (nullable = true)\n |-- m_3: double (nullable = true)\n |-- m_4: double (nullable = true)\n |-- dm_1: double (nullable = true)\n |-- dm_2: double (nullable = true)\n |-- dm_3: double (nullable = true)\n |-- dm_4: double (nullable = true)\n |-- df_1: double (nullable = true)\n |-- df_2: double (nullable = true)\n |-- df_3: double (nullable = true)\n |-- df_4: double (nullable = true)\n |-- age: integer (nullable = true)\n |-- error: integer (nullable = true)\n\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"train","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"error","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null},{"name":"test","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"error","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228240608,"submitTime":1547228227475,"finishTime":1547228253392,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b1aa9ca6-5381-4d2d-a74a-33afb19cf561"},{"version":"CommandV1","origId":3771102850754004,"guid":"fa59a46a-863d-42be-8f2f-0492669920fd","subtype":"command","commandType":"auto","position":9.0,"command":"%md #Define Model","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e306b3fe-fae7-43f1-a434-e0acc431808a"},{"version":"CommandV1","origId":3771102850754005,"guid":"6b4aef11-c693-4e6e-a629-af981a91bd0b","subtype":"command","commandType":"auto","position":10.0,"command":"label = \"error\"\ndtypes = dict(train.dtypes)\ndtypes.pop(label)\n\nsi_xvars = []\nohe_xvars = []\nfeatureCols = []\nfor idx,key in enumerate(dtypes):\n    if dtypes[key] == \"string\":\n        featureCol = \"-\".join([key, \"encoded\"])\n        featureCols.append(featureCol)\n        \n        tmpCol = \"-\".join([key, \"tmp\"])\n        # string-index and one-hot encode the string column\n        #https://spark.apache.org/docs/2.3.0/api/java/org/apache/spark/ml/feature/StringIndexer.html\n        #handleInvalid: Param for how to handle invalid data (unseen labels or NULL values). \n        #Options are 'skip' (filter out rows with invalid data), 'error' (throw an error), \n        #or 'keep' (put invalid data in a special additional bucket, at index numLabels). Default: \"error\"\n        si_xvars.append(StringIndexer(inputCol=key, outputCol=tmpCol, handleInvalid=\"skip\"))\n        ohe_xvars.append(OneHotEncoder(inputCol=tmpCol, outputCol=featureCol))\n    else:\n        featureCols.append(key)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228253404,"submitTime":1547228229917,"finishTime":1547228253448,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"cf16107e-79bc-46d5-97a1-ebc4aef44ade"},{"version":"CommandV1","origId":3771102850754006,"guid":"1e6960c2-277e-4062-a067-b6dee4a335a3","subtype":"command","commandType":"auto","position":11.0,"command":"from azureml.core.run import Run\nfrom azureml.core.experiment import Experiment\nimport numpy as np\nimport os\nimport shutil\n\nmodel_name = \"PdM_logistic_regression.mml\"\nmodel_dbfs = os.path.join(\"/dbfs\", model_name)\nrun_history_name = 'spark-ml-notebook'\n\n# start a training run by defining an experiment\nmyexperiment = Experiment(ws, \"AI_Airlft\")\nroot_run = myexperiment.start_logging()\n\n# Regularization Rates - \nregs = [0.0001] # , 0.001, 0.01, 0.1]\n \n# try a bunch of regularization rate in a Logistic Regression model\nfor reg in regs:\n    print(\"Regularization rate: {}\".format(reg))\n    # create a bunch of child runs\n    with root_run.child_run(\"reg-\" + str(reg)) as run:\n        # create a new Logistic Regression model.\n        lr = LogisticRegression(regParam=reg)\n        \n        # put together the pipeline\n        pipe = Pipeline(stages=[*si_xvars, *ohe_xvars, si_label, assembler, lr])\n\n        # train the model\n        model_p = pipe.fit(train)\n        \n        # make prediction\n        pred = model_p.transform(test)\n        \n        # evaluate. note only 2 metrics are supported out of the box by Spark ML.\n        bce = BinaryClassificationEvaluator(rawPredictionCol='rawPrediction')\n        au_roc = bce.setMetricName('areaUnderROC').evaluate(pred)\n        au_prc = bce.setMetricName('areaUnderPR').evaluate(pred)\n\n        print(\"Area under ROC: {}\".format(au_roc))\n        print(\"Area Under PR: {}\".format(au_prc))\n      \n        # log reg, au_roc, au_prc and feature names in run history\n        run.log(\"reg\", reg)\n        run.log(\"au_roc\", au_roc)\n        run.log(\"au_prc\", au_prc)\n        run.log_list(\"columns\", train.columns)\n\n        # save model\n        model_p.write().overwrite().save(model_name)\n        \n        # upload the serialized model into run history record\n        mdl, ext = model_name.split(\".\")\n        model_zip = mdl + \".zip\"\n        shutil.make_archive(mdl, 'zip', model_dbfs)\n        run.upload_file(\"outputs/\" + model_name, model_zip)        \n        #run.upload_file(\"outputs/\" + model_name, path_or_stream = model_dbfs) #cannot deal with folders\n\n        # now delete the serialized model from local folder since it is already uploaded to run history \n        shutil.rmtree(model_dbfs)\n        os.remove(model_zip)\n        \n# Declare run completed\nroot_run.complete()\nroot_run_id = root_run.id\nprint (\"run id:\", root_run.id)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Regularization rate: 0.0001\nArea under ROC: 0.9565039930579382\nArea Under PR: 0.41544914310699604\nrun id: a5382928-f73c-41bf-98e0-56155183bf75\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"pred","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"error","nullable":true,"type":"integer"},{"metadata":{"ml_attr":{"name":"label","type":"nominal","vals":["0","1"]}},"name":"label","nullable":false,"type":"double"},{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"df_3"},{"idx":1,"name":"e_5"},{"idx":2,"name":"dm_4"},{"idx":3,"name":"rotate_sd_12"},{"idx":4,"name":"pressure_ma_3"},{"idx":5,"name":"m_1"},{"idx":6,"name":"rotate_ma_12"},{"idx":7,"name":"e_3"},{"idx":8,"name":"pressure_ma_12"},{"idx":9,"name":"m_4"},{"idx":10,"name":"de_1"},{"idx":11,"name":"dm_1"},{"idx":12,"name":"e_1"},{"idx":13,"name":"vibration_ma_3"},{"idx":14,"name":"de_5"},{"idx":15,"name":"vibration_sd_12"},{"idx":16,"name":"rotate_ma_3"},{"idx":17,"name":"vibration_ma_12"},{"idx":18,"name":"volt_ma_12"},{"idx":19,"name":"volt_ma_3"},{"idx":20,"name":"de_2"},{"idx":21,"name":"rotate_sd_3"},{"idx":22,"name":"df_4"},{"idx":23,"name":"age"},{"idx":24,"name":"df_1"},{"idx":25,"name":"df_2"},{"idx":26,"name":"m_3"},{"idx":27,"name":"volt_sd_12"},{"idx":28,"name":"pressure_sd_3"},{"idx":29,"name":"vibration_sd_3"},{"idx":30,"name":"pressure_sd_12"},{"idx":31,"name":"m_2"},{"idx":32,"name":"e_4"},{"idx":33,"name":"volt_sd_3"},{"idx":34,"name":"de_3"},{"idx":35,"name":"dm_2"},{"idx":36,"name":"dm_3"},{"idx":37,"name":"de_4"},{"idx":38,"name":"e_2"}]},"num_attrs":39}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"rawPrediction","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"probability","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"prediction","nullable":false,"type":"double"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228253580,"submitTime":1547228231859,"finishTime":1547228338525,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a0822218-5f42-4fea-829d-947f63b1fbdf"},{"version":"CommandV1","origId":3771102850754007,"guid":"73719f08-8e1f-462b-8e11-89b67321b6b6","subtype":"command","commandType":"auto","position":12.0,"command":"metrics = root_run.get_metrics(recursive=True)\nbest_run_id = max(metrics, key = lambda k: metrics[k]['au_roc'])\nbest_run = child_runs[best_run_id]\nprint('Best run is:', best_run_id)\nprint('Metrics:', metrics[best_run_id]['au_roc'], metrics[best_run_id]['reg'])","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Best run is: 24df59af-9e9a-45cc-aeff-f384d1f0c4ea\nMetrics: 0.9565039930579382 0.0001\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228339265,"submitTime":1547228236215,"finishTime":1547228339653,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"aebc3552-6e57-40b5-aa72-d6a19e2a695a"},{"version":"CommandV1","origId":3771102850754009,"guid":"1e80d0c5-a9d4-49d3-8a00-49751f4ac151","subtype":"command","commandType":"auto","position":14.0,"command":"#Download the model from the best run to a local folder\nbest_model_file_name = \"best_model.zip\"\nbest_run.download_file(name = 'outputs/' + model_name, output_file_path = best_model_file_name)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228339659,"submitTime":1547228238771,"finishTime":1547228340048,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f8c45449-ba54-4e85-abc4-2609cbdf041d"},{"version":"CommandV1","origId":3771102850754010,"guid":"3c719072-3a0e-4009-bb30-265425d0a8a6","subtype":"command","commandType":"auto","position":15.0,"command":"%md #Model Evaluation","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"53a48ccc-ac57-44c2-85d6-c70274fab503"},{"version":"CommandV1","origId":3771102850754011,"guid":"6a8878a2-56f7-4340-b3b8-c248c683756c","subtype":"command","commandType":"auto","position":16.0,"command":"##unzip the model to dbfs (as load() seems to require that) and load it.\nif os.path.isfile(model_dbfs) or os.path.isdir(model_dbfs):\n    shutil.rmtree(model_dbfs)\nshutil.unpack_archive(best_model_file_name, model_dbfs)\n\nmodel_p_best = PipelineModel.load(model_name)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228340056,"submitTime":1547228242453,"finishTime":1547228350337,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f76cde2c-bff4-4eb8-9a2c-51a604dd9988"},{"version":"CommandV1","origId":3771102850754012,"guid":"9f645cbd-e432-4455-b65c-733dbe7db027","subtype":"command","commandType":"auto","position":17.0,"command":"# make prediction\npred = model_p_best.transform(test)\noutput = pred[['volt_ma_3','rotate_ma_3','pressure_ma_3','vibration_ma_3','error','prediction']]\ndisplay(output.limit(5))","commandVersion":1,"state":"finished","results":{"type":"table","data":[[183.85920761842786,443.2801691310877,96.84285203342347,42.01872540592673,0,0.0],[152.97192210587193,451.8851814204174,93.83648593838522,39.19835273034629,0,0.0],[172.00969263954593,435.77031093021543,113.7860482161566,38.860593514613186,0,0.0],[166.63686460927786,479.4466196930593,99.56517307207973,33.14433666894849,0,0.0],[174.82912208500974,443.6826433789454,105.91870952534258,42.30613974243651,0,0.0]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"volt_ma_3","type":"\"double\"","metadata":"{}"},{"name":"rotate_ma_3","type":"\"double\"","metadata":"{}"},{"name":"pressure_ma_3","type":"\"double\"","metadata":"{}"},{"name":"vibration_ma_3","type":"\"double\"","metadata":"{}"},{"name":"error","type":"\"integer\"","metadata":"{}"},{"name":"prediction","type":"\"double\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[{"name":"pred","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"error","nullable":true,"type":"integer"},{"metadata":{"ml_attr":{"name":"label","type":"nominal","vals":["0","1"]}},"name":"label","nullable":false,"type":"double"},{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"df_3"},{"idx":1,"name":"e_5"},{"idx":2,"name":"dm_4"},{"idx":3,"name":"rotate_sd_12"},{"idx":4,"name":"pressure_ma_3"},{"idx":5,"name":"m_1"},{"idx":6,"name":"rotate_ma_12"},{"idx":7,"name":"e_3"},{"idx":8,"name":"pressure_ma_12"},{"idx":9,"name":"m_4"},{"idx":10,"name":"de_1"},{"idx":11,"name":"dm_1"},{"idx":12,"name":"e_1"},{"idx":13,"name":"vibration_ma_3"},{"idx":14,"name":"de_5"},{"idx":15,"name":"vibration_sd_12"},{"idx":16,"name":"rotate_ma_3"},{"idx":17,"name":"vibration_ma_12"},{"idx":18,"name":"volt_ma_12"},{"idx":19,"name":"volt_ma_3"},{"idx":20,"name":"de_2"},{"idx":21,"name":"rotate_sd_3"},{"idx":22,"name":"df_4"},{"idx":23,"name":"age"},{"idx":24,"name":"df_1"},{"idx":25,"name":"df_2"},{"idx":26,"name":"m_3"},{"idx":27,"name":"volt_sd_12"},{"idx":28,"name":"pressure_sd_3"},{"idx":29,"name":"vibration_sd_3"},{"idx":30,"name":"pressure_sd_12"},{"idx":31,"name":"m_2"},{"idx":32,"name":"e_4"},{"idx":33,"name":"volt_sd_3"},{"idx":34,"name":"de_3"},{"idx":35,"name":"dm_2"},{"idx":36,"name":"dm_3"},{"idx":37,"name":"de_4"},{"idx":38,"name":"e_2"}]},"num_attrs":39}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"rawPrediction","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"probability","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"prediction","nullable":false,"type":"double"}],"type":"struct"},"tableIdentifier":null},{"name":"output","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"error","nullable":true,"type":"integer"},{"metadata":{},"name":"prediction","nullable":false,"type":"double"}],"type":"struct"},"tableIdentifier":null}],"columnCustomDisplayInfos":{}},"errorSummary":"<span class=\"ansired\">AnalysisException</span>: &quot;cannot resolve &apos;&#96;voltage&#96;&apos; given input columns: [label, dm_4, de_3, vibration_ma_3, df_4, probability, pressure_sd_12, rotate_ma_12, m_3, prediction, rawPrediction, volt_ma_3, e_4, e_2, vibration_sd_12, age, volt_sd_12, de_1, de_5, m_2, vibration_sd_3, df_1, e_3, volt_ma_12, dm_1, df_3, features, volt_sd_3, error, rotate_sd_12, dm_3, m_1, de_2, pressure_sd_3, pressure_ma_12, dm_2, e_1, pressure_ma_3, rotate_sd_3, vibration_ma_12, de_4, rotate_ma_3, df_2, e_5, m_4];;\\n&apos;Project [&apos;voltage, &apos;rotation, &apos;pressure, &apos;temperature, error#34261, prediction#37993]\\n+- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 21 more fields]\\n   +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 20 more fields]\\n      +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 19 more fields]\\n         +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 18 more fields]\\n            +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 17 more fields]\\n               +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 16 more fields]\\n                  +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 16 more fields]\\n                     +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 19 more fields]\\n                        +- Join Inner, (ColumnIndex#33271L = ColumnIndex#33320L)\\n                           :- LogicalRDD [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 16 more fields], false\\n                           +- LogicalRDD [y_1#33316, y_2#33317, y_3#33318, y_4#33319, ColumnIndex#33320L], false\\n&quot;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AnalysisException</span>                         Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-3771102850754012&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansired\"># make prediction</span><span class=\"ansiyellow\"></span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> pred <span class=\"ansiyellow\">=</span> model_p_best<span class=\"ansiyellow\">.</span>transform<span class=\"ansiyellow\">(</span>test<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 3</span><span class=\"ansiyellow\"> </span>output <span class=\"ansiyellow\">=</span> pred<span class=\"ansiyellow\">[</span><span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;voltage&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;rotation&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;pressure&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;temperature&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;error&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;prediction&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> display<span class=\"ansiyellow\">(</span>output<span class=\"ansiyellow\">.</span>limit<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">5</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/dataframe.py</span> in <span class=\"ansicyan\">__getitem__</span><span class=\"ansiblue\">(self, item)</span>\n<span class=\"ansigreen\">   1307</span>             <span class=\"ansigreen\">return</span> self<span class=\"ansiyellow\">.</span>filter<span class=\"ansiyellow\">(</span>item<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1308</span>         <span class=\"ansigreen\">elif</span> isinstance<span class=\"ansiyellow\">(</span>item<span class=\"ansiyellow\">,</span> <span class=\"ansiyellow\">(</span>list<span class=\"ansiyellow\">,</span> tuple<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">-&gt; 1309</span><span class=\"ansiyellow\">             </span><span class=\"ansigreen\">return</span> self<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>item<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1310</span>         <span class=\"ansigreen\">elif</span> isinstance<span class=\"ansiyellow\">(</span>item<span class=\"ansiyellow\">,</span> int<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1311</span>             jc <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jdf<span class=\"ansiyellow\">.</span>apply<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>columns<span class=\"ansiyellow\">[</span>item<span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/dataframe.py</span> in <span class=\"ansicyan\">select</span><span class=\"ansiblue\">(self, *cols)</span>\n<span class=\"ansigreen\">   1343</span>         <span class=\"ansiyellow\">[</span>Row<span class=\"ansiyellow\">(</span>name<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;Alice&apos;</span><span class=\"ansiyellow\">,</span> age<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">12</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">,</span> Row<span class=\"ansiyellow\">(</span>name<span class=\"ansiyellow\">=</span><span class=\"ansiblue\">u&apos;Bob&apos;</span><span class=\"ansiyellow\">,</span> age<span class=\"ansiyellow\">=</span><span class=\"ansicyan\">15</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1344</span>         &quot;&quot;&quot;\n<span class=\"ansigreen\">-&gt; 1345</span><span class=\"ansiyellow\">         </span>jdf <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>_jdf<span class=\"ansiyellow\">.</span>select<span class=\"ansiyellow\">(</span>self<span class=\"ansiyellow\">.</span>_jcols<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">*</span>cols<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1346</span>         <span class=\"ansigreen\">return</span> DataFrame<span class=\"ansiyellow\">(</span>jdf<span class=\"ansiyellow\">,</span> self<span class=\"ansiyellow\">.</span>sql_ctx<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1347</span> <span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/lib/py4j-0.10.7-src.zip/py4j/java_gateway.py</span> in <span class=\"ansicyan\">__call__</span><span class=\"ansiblue\">(self, *args)</span>\n<span class=\"ansigreen\">   1255</span>         answer <span class=\"ansiyellow\">=</span> self<span class=\"ansiyellow\">.</span>gateway_client<span class=\"ansiyellow\">.</span>send_command<span class=\"ansiyellow\">(</span>command<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1256</span>         return_value = get_return_value(\n<span class=\"ansigreen\">-&gt; 1257</span><span class=\"ansiyellow\">             answer, self.gateway_client, self.target_id, self.name)\n</span><span class=\"ansigreen\">   1258</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">   1259</span>         <span class=\"ansigreen\">for</span> temp_arg <span class=\"ansigreen\">in</span> temp_args<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/spark/python/pyspark/sql/utils.py</span> in <span class=\"ansicyan\">deco</span><span class=\"ansiblue\">(*a, **kw)</span>\n<span class=\"ansigreen\">     67</span>                                              e.java_exception.getStackTrace()))\n<span class=\"ansigreen\">     68</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.AnalysisException: &apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 69</span><span class=\"ansiyellow\">                 </span><span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     70</span>             <span class=\"ansigreen\">if</span> s<span class=\"ansiyellow\">.</span>startswith<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;org.apache.spark.sql.catalyst.analysis&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     71</span>                 <span class=\"ansigreen\">raise</span> AnalysisException<span class=\"ansiyellow\">(</span>s<span class=\"ansiyellow\">.</span>split<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;: &apos;</span><span class=\"ansiyellow\">,</span> <span class=\"ansicyan\">1</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">[</span><span class=\"ansicyan\">1</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">,</span> stackTrace<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AnalysisException</span>: &quot;cannot resolve &apos;&#96;voltage&#96;&apos; given input columns: [label, dm_4, de_3, vibration_ma_3, df_4, probability, pressure_sd_12, rotate_ma_12, m_3, prediction, rawPrediction, volt_ma_3, e_4, e_2, vibration_sd_12, age, volt_sd_12, de_1, de_5, m_2, vibration_sd_3, df_1, e_3, volt_ma_12, dm_1, df_3, features, volt_sd_3, error, rotate_sd_12, dm_3, m_1, de_2, pressure_sd_3, pressure_ma_12, dm_2, e_1, pressure_ma_3, rotate_sd_3, vibration_ma_12, de_4, rotate_ma_3, df_2, e_5, m_4];;\\n&apos;Project [&apos;voltage, &apos;rotation, &apos;pressure, &apos;temperature, error#34261, prediction#37993]\\n+- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 21 more fields]\\n   +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 20 more fields]\\n      +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 19 more fields]\\n         +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 18 more fields]\\n            +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 17 more fields]\\n               +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 16 more fields]\\n                  +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 16 more fields]\\n                     +- Project [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 19 more fields]\\n                        +- Join Inner, (ColumnIndex#33271L = ColumnIndex#33320L)\\n                           :- LogicalRDD [volt_ma_3#33232, rotate_ma_3#33233, pressure_ma_3#33234, vibration_ma_3#33235, volt_sd_3#33236, rotate_sd_3#33237, pressure_sd_3#33238, vibration_sd_3#33239, volt_ma_12#33240, rotate_ma_12#33241, pressure_ma_12#33242, vibration_ma_12#33243, volt_sd_12#33244, rotate_sd_12#33245, pressure_sd_12#33246, vibration_sd_12#33247, e_1#33248, e_2#33249, e_3#33250, e_4#33251, e_5#33252, de_1#33253, de_2#33254, de_3#33255, ... 16 more fields], false\\n                           +- LogicalRDD [y_1#33316, y_2#33317, y_3#33318, y_4#33319, ColumnIndex#33320L], false\\n&quot;</div>","workflows":[],"startTime":1547228350347,"submitTime":1547228244237,"finishTime":1547228351318,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f7a4ee76-1080-499c-885d-acad249ba8dd"},{"version":"CommandV1","origId":3771102850754013,"guid":"519ebbce-dd09-40a3-8e7c-fad758b0401d","subtype":"command","commandType":"auto","position":18.0,"command":"# evaluate. note only 2 metrics are supported out of the box by Spark ML.\nbce = BinaryClassificationEvaluator(rawPredictionCol='rawPrediction')\nau_roc = bce.setMetricName('areaUnderROC').evaluate(pred)\nau_prc = bce.setMetricName('areaUnderPR').evaluate(pred)\n\nprint(\"Area under ROC: {}\".format(au_roc))\nprint(\"Area Under PR: {}\".format(au_prc))","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Area under ROC: 0.9565039930579383\nArea Under PR: 0.4154491431069958\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228422902,"submitTime":1547228422913,"finishTime":1547228433864,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"86955f95-46a4-4aaf-9fb2-7df0fa5e94e1"},{"version":"CommandV1","origId":3771102850754014,"guid":"c04de6f6-9adb-429e-b9b1-f82f9ab38297","subtype":"command","commandType":"auto","position":19.0,"command":"%md #Model Persistence","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"9ba2456a-a267-45e8-8f3e-735671d1fc2f"},{"version":"CommandV1","origId":3771102850754015,"guid":"936c1ca7-c031-4613-8bfb-b9a67d720e80","subtype":"command","commandType":"auto","position":20.0,"command":"##NOTE: by default the model is saved to and loaded from /dbfs/ instead of cwd!\nmodel_p_best.write().overwrite().save(model_name)\nprint(\"saved model to {}\".format(model_dbfs))","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">saved model to /dbfs/PdM_logistic_regression.mml\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228433872,"submitTime":1547228423738,"finishTime":1547228438130,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ff83475b-5e09-4671-b4ef-e48eb9f7ed7f"},{"version":"CommandV1","origId":3771102850754016,"guid":"ba6c8bd3-43cb-4e59-b4da-cf3ca4a3cef4","subtype":"command","commandType":"auto","position":21.0,"command":"%sh\n\nls -la /dbfs/PdM_logistic_regresion.mml/*","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">/dbfs/PdM_logistic_regresion.mml/metadata:\ntotal 0\ndrwxr-xr-x 1 root root   0 Jan 10 22:16 .\ndrwxr-xr-x 1 root root   0 Jan 10 22:16 ..\n-rw-r--r-- 1 root root 272 Jan 10 22:16 part-00000\n-rw-r--r-- 1 root root   0 Jan 10 22:16 _SUCCESS\n\n/dbfs/PdM_logistic_regresion.mml/stages:\ntotal 0\ndrwxr-xr-x 1 root root 0 Jan 10 22:16 .\ndrwxr-xr-x 1 root root 0 Jan 10 22:16 ..\ndrwxr-xr-x 1 root root 0 Jan 10 22:16 0_StringIndexer_cd0dc41919d8\ndrwxr-xr-x 1 root root 0 Jan 10 22:16 1_VectorAssembler_5bc1d0633a80\ndrwxr-xr-x 1 root root 0 Jan 10 22:16 2_LogisticRegression_ee52ec021ebb\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228438139,"submitTime":1547228431117,"finishTime":1547228438415,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f8cb39fe-e577-4bba-a601-29903159e1be"},{"version":"CommandV1","origId":3771102850754017,"guid":"a2119071-962a-4cfc-967e-5d39b99b11d8","subtype":"command","commandType":"auto","position":22.0,"command":"dbutils.notebook.exit(\"success\")","commandVersion":1,"state":"finished","results":{"type":"exit","data":"success","arguments":{}},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228438421,"submitTime":1547228434380,"finishTime":1547228438449,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c5c75192-29ba-43af-9c6c-0c0f109b9cf7"},{"version":"CommandV1","origId":3771102850754018,"guid":"1f7b66da-5836-4ac3-a913-3fb2dd98102d","subtype":"command","commandType":"auto","position":2.5,"command":"%run \"../Includes/Setup Environment\"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":1547157595759,"submitTime":1547157595759,"finishTime":1547157598932,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e288e3c4-46d3-4619-9b76-946885a6d95f"},{"version":"CommandV1","origId":3771102850754021,"guid":"857c3821-b489-4f7a-9649-5e8652c0f72a","subtype":"command","commandType":"auto","position":7.0,"command":"import urllib.request # for downloading data\nimport os\n\ncontainer_url = 'https://sethmottstore.blob.core.windows.net/predmaint/'\ndata_dir = '/dbfs/tmp/data'\nos.makedirs(data_dir, exist_ok=True)\n\nfor filename in ['X_train.csv', 'X_test.csv', 'y_train.csv', 'y_test.csv']:\n  if not os.path.exists(os.path.join('/dbfs/tmp/data/', filename)):\n    urllib.request.urlretrieve(container_url + filename, filename=os.path.join(data_dir, filename))","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228220420,"submitTime":1547228220419,"finishTime":1547228220554,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"191c91a2-0df9-45e4-9b53-0eaebe2bcd6b"},{"version":"CommandV1","origId":3771102850754022,"guid":"1713c40d-7563-4a7a-84da-20c94e1c4e4d","subtype":"command","commandType":"auto","position":7.5,"command":"os.listdir(data_dir)","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">6</span><span class=\"ansired\">]: </span>[&apos;X_test.csv&apos;, &apos;X_train.csv&apos;, &apos;y_test.csv&apos;, &apos;y_train.csv&apos;]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228221312,"submitTime":1547228221311,"finishTime":1547228221372,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ab483010-ca86-42d8-84a0-d139560383c0"},{"version":"CommandV1","origId":3771102850754023,"guid":"4eebcda5-ea8a-4322-8eff-16174b540d3b","subtype":"command","commandType":"auto","position":7.75,"command":"X_train = spark.read.option(\"header\", \"true\").option(\"inferSchema\", \"true\").csv(os.path.join('/tmp/data', 'X_train.csv'), header=\"true\")\nX_test = spark.read.option(\"header\", \"true\").option(\"inferSchema\", \"true\").csv(os.path.join('/tmp/data', 'X_test.csv'), header=\"true\")\ny_train = spark.read.option(\"header\", \"true\").option(\"inferSchema\", \"true\").csv(os.path.join('/tmp/data', 'y_train.csv'), header=\"true\")\ny_test = spark.read.option(\"header\", \"true\").option(\"inferSchema\", \"true\").csv(os.path.join('/tmp/data', 'y_test.csv'), header=\"true\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"X_train","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null},{"name":"X_test","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null},{"name":"y_train","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"y_1","nullable":true,"type":"integer"},{"metadata":{},"name":"y_2","nullable":true,"type":"integer"},{"metadata":{},"name":"y_3","nullable":true,"type":"integer"},{"metadata":{},"name":"y_4","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null},{"name":"y_test","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"y_1","nullable":true,"type":"integer"},{"metadata":{},"name":"y_2","nullable":true,"type":"integer"},{"metadata":{},"name":"y_3","nullable":true,"type":"integer"},{"metadata":{},"name":"y_4","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228221812,"submitTime":1547228221812,"finishTime":1547228235923,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b8ec984e-a268-437e-a925-8a0f2cc76e2e"},{"version":"CommandV1","origId":3771102850754024,"guid":"3272cce6-edd7-4fa3-9316-454248c0a89c","subtype":"command","commandType":"auto","position":7.875,"command":"from pyspark.sql.types import StructType, StructField, LongType\n\ndef with_column_index(df): \n    new_schema = StructType(df.schema.fields + [StructField(\"ColumnIndex\", LongType(), False),])\n    return df.rdd.zipWithIndex().map(lambda row: row[0] + (row[1],)).toDF(schema=new_schema)\n\nX_train_ci = with_column_index(X_train)\ny_train_ci = with_column_index(y_train)\ntrain = X_train_ci.join(y_train_ci, X_train_ci.ColumnIndex == y_train_ci.ColumnIndex, 'inner').drop(\"ColumnIndex\").cache()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"X_train_ci","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"ColumnIndex","nullable":false,"type":"long"}],"type":"struct"},"tableIdentifier":null},{"name":"y_train_ci","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"y_1","nullable":true,"type":"integer"},{"metadata":{},"name":"y_2","nullable":true,"type":"integer"},{"metadata":{},"name":"y_3","nullable":true,"type":"integer"},{"metadata":{},"name":"y_4","nullable":true,"type":"integer"},{"metadata":{},"name":"ColumnIndex","nullable":false,"type":"long"}],"type":"struct"},"tableIdentifier":null},{"name":"train","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"y_1","nullable":true,"type":"integer"},{"metadata":{},"name":"y_2","nullable":true,"type":"integer"},{"metadata":{},"name":"y_3","nullable":true,"type":"integer"},{"metadata":{},"name":"y_4","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228235932,"submitTime":1547228224494,"finishTime":1547228239367,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"81538d03-c19e-4564-ae6e-28d13f3639f5"},{"version":"CommandV1","origId":3771102850754025,"guid":"12243bb1-2426-4ffc-9545-9cda2ca65a6c","subtype":"command","commandType":"auto","position":7.9375,"command":"from pyspark.sql.types import StructType, StructField, LongType\n\ndef with_column_index(df): \n    new_schema = StructType(df.schema.fields + [StructField(\"ColumnIndex\", LongType(), False),])\n    return df.rdd.zipWithIndex().map(lambda row: row[0] + (row[1],)).toDF(schema=new_schema)\n\nX_test_ci = with_column_index(X_test)\ny_test_ci = with_column_index(y_test)\ntest = X_test_ci.join(y_test_ci, X_test_ci.ColumnIndex == y_test_ci.ColumnIndex, 'inner').drop(\"ColumnIndex\").cache()","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"X_test_ci","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"ColumnIndex","nullable":false,"type":"long"}],"type":"struct"},"tableIdentifier":null},{"name":"y_test_ci","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"y_1","nullable":true,"type":"integer"},{"metadata":{},"name":"y_2","nullable":true,"type":"integer"},{"metadata":{},"name":"y_3","nullable":true,"type":"integer"},{"metadata":{},"name":"y_4","nullable":true,"type":"integer"},{"metadata":{},"name":"ColumnIndex","nullable":false,"type":"long"}],"type":"struct"},"tableIdentifier":null},{"name":"test","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"y_1","nullable":true,"type":"integer"},{"metadata":{},"name":"y_2","nullable":true,"type":"integer"},{"metadata":{},"name":"y_3","nullable":true,"type":"integer"},{"metadata":{},"name":"y_4","nullable":true,"type":"integer"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228239374,"submitTime":1547228225130,"finishTime":1547228240599,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"af85cedd-d47d-4114-818e-97cf98673738"},{"version":"CommandV1","origId":3771102850754026,"guid":"430b0d36-ff1d-4bd5-b49d-b158f081d7ec","subtype":"command","commandType":"auto","position":10.5,"command":"# string-index the label column into a column named \"label\"\nsi_label = StringIndexer(inputCol=label, outputCol='label')\n\n# assemble the encoded feature columns in to a column named \"features\"\nassembler = VectorAssembler(inputCols=featureCols, outputCol=\"features\")","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228253484,"submitTime":1547228231495,"finishTime":1547228253574,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f9a20f3c-02a9-4c64-b435-dbf2adba96c6"},{"version":"CommandV1","origId":3771102850754027,"guid":"95a91582-daf6-444f-826c-4ea89b0398b5","subtype":"command","commandType":"auto","position":10.25,"command":"print(\"Feature columns: {}\".format(featureCols) )","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Feature columns: [&apos;df_3&apos;, &apos;e_5&apos;, &apos;dm_4&apos;, &apos;rotate_sd_12&apos;, &apos;pressure_ma_3&apos;, &apos;m_1&apos;, &apos;rotate_ma_12&apos;, &apos;e_3&apos;, &apos;pressure_ma_12&apos;, &apos;m_4&apos;, &apos;de_1&apos;, &apos;dm_1&apos;, &apos;e_1&apos;, &apos;vibration_ma_3&apos;, &apos;de_5&apos;, &apos;vibration_sd_12&apos;, &apos;rotate_ma_3&apos;, &apos;vibration_ma_12&apos;, &apos;volt_ma_12&apos;, &apos;volt_ma_3&apos;, &apos;de_2&apos;, &apos;rotate_sd_3&apos;, &apos;df_4&apos;, &apos;age&apos;, &apos;df_1&apos;, &apos;df_2&apos;, &apos;m_3&apos;, &apos;volt_sd_12&apos;, &apos;pressure_sd_3&apos;, &apos;vibration_sd_3&apos;, &apos;pressure_sd_12&apos;, &apos;m_2&apos;, &apos;e_4&apos;, &apos;volt_sd_3&apos;, &apos;de_3&apos;, &apos;dm_2&apos;, &apos;dm_3&apos;, &apos;de_4&apos;, &apos;e_2&apos;]\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228253457,"submitTime":1547228230732,"finishTime":1547228253479,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"65092c30-a3b6-4c57-8427-e315b1cd06c5"},{"version":"CommandV1","origId":3771102850754138,"guid":"40dd6e8d-0b6a-4a0c-9475-7d9a147814fd","subtype":"command","commandType":"auto","position":11.5,"command":"#Load all run metrics from run history into a dictionary object.\nchild_runs = {}\n\nfor r in root_run.get_children():\n    child_runs[r.id] = r","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547228338532,"submitTime":1547228234875,"finishTime":1547228339258,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6de3a354-5c72-4e28-8c0e-87e9fa0c5d83"},{"version":"CommandV1","origId":3771102850754142,"guid":"1dfa5e90-f6e0-4914-878e-1fce591ee26a","subtype":"script","commandType":"auto","position":2.8333333333333335,"command":"","commandVersion":0,"state":"finished","results":{"type":"htmlSandbox","data":"\n  <div>Successfully created class variables and utility functions.</div>\n  <li><b>username</b>: wopauli@microsoft.com</li>\n  <li><b>userhome</b>: dbfs:/user/wopauli@microsoft.com</li>\n","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547157595784,"submitTime":0,"finishTime":1547157598594,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["1f7b66da-5836-4ac3-a913-3fb2dd98102d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"ce0e922e-bcd4-490b-86ff-635da9c343b4"},{"version":"CommandV1","origId":3771102850754143,"guid":"3d7e7c27-f73b-41ad-9905-3987685eba52","subtype":"script","commandType":"auto","position":3.1666666666666665,"command":"","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547157598596,"submitTime":0,"finishTime":1547157598636,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":["1f7b66da-5836-4ac3-a913-3fb2dd98102d"],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b2c2a873-4b79-4043-988c-46292a75c2a3"},{"version":"CommandV1","origId":3771102850754146,"guid":"16677bfb-ac89-4890-9f86-a7984f9085d3","subtype":"command","commandType":"auto","position":17.25,"command":"import pyspark.sql.functions as F\n\nselectPred = pred.orderBy(F.desc('prediction')).limit(5)\nselectPred = selectPred.union(pred.orderBy(F.asc('prediction')).limit(5))\n\noutput = selectPred[['volt_ma_3','rotate_ma_3','pressure_ma_3','vibration_ma_3','error','prediction']]\ndisplay(output)","commandVersion":0,"state":"finished","results":{"type":"table","data":[[179.40881216169262,453.0050845840294,102.00551270289195,44.572484222258566,0,1.0],[199.0467068466747,492.5090420082449,98.73426936334131,40.05338788332681,1,1.0],[211.1828184270937,438.05487024156656,101.77108419452952,43.239552833533914,1,1.0],[192.03723544554077,477.22021932789266,104.52648545597636,44.02415937207579,0,1.0],[191.81952954632388,408.29937189108824,102.83246592179569,41.62170031273823,0,1.0],[183.85920761842786,443.2801691310877,96.84285203342347,42.01872540592673,0,0.0],[152.97192210587193,451.8851814204174,93.83648593838522,39.19835273034629,0,0.0],[172.00969263954593,435.77031093021543,113.7860482161566,38.860593514613186,0,0.0],[166.63686460927786,479.4466196930593,99.56517307207973,33.14433666894849,0,0.0],[174.82912208500974,443.6826433789454,105.91870952534258,42.30613974243651,0,0.0]],"arguments":{},"addedWidgets":{},"removedWidgets":[],"schema":[{"name":"volt_ma_3","type":"\"double\"","metadata":"{}"},{"name":"rotate_ma_3","type":"\"double\"","metadata":"{}"},{"name":"pressure_ma_3","type":"\"double\"","metadata":"{}"},{"name":"vibration_ma_3","type":"\"double\"","metadata":"{}"},{"name":"error","type":"\"integer\"","metadata":"{}"},{"name":"prediction","type":"\"double\"","metadata":"{}"}],"overflow":false,"aggData":[],"aggSchema":[],"aggOverflow":false,"aggSeriesLimitReached":false,"aggError":"","aggType":"","plotOptions":null,"isJsonSchema":true,"dbfsResultPath":null,"datasetInfos":[{"name":"selectPred","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_3","nullable":true,"type":"double"},{"metadata":{},"name":"volt_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_12","nullable":true,"type":"double"},{"metadata":{},"name":"volt_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_sd_12","nullable":true,"type":"double"},{"metadata":{},"name":"e_1","nullable":true,"type":"double"},{"metadata":{},"name":"e_2","nullable":true,"type":"double"},{"metadata":{},"name":"e_3","nullable":true,"type":"double"},{"metadata":{},"name":"e_4","nullable":true,"type":"double"},{"metadata":{},"name":"e_5","nullable":true,"type":"double"},{"metadata":{},"name":"de_1","nullable":true,"type":"double"},{"metadata":{},"name":"de_2","nullable":true,"type":"double"},{"metadata":{},"name":"de_3","nullable":true,"type":"double"},{"metadata":{},"name":"de_4","nullable":true,"type":"double"},{"metadata":{},"name":"de_5","nullable":true,"type":"double"},{"metadata":{},"name":"m_1","nullable":true,"type":"double"},{"metadata":{},"name":"m_2","nullable":true,"type":"double"},{"metadata":{},"name":"m_3","nullable":true,"type":"double"},{"metadata":{},"name":"m_4","nullable":true,"type":"double"},{"metadata":{},"name":"dm_1","nullable":true,"type":"double"},{"metadata":{},"name":"dm_2","nullable":true,"type":"double"},{"metadata":{},"name":"dm_3","nullable":true,"type":"double"},{"metadata":{},"name":"dm_4","nullable":true,"type":"double"},{"metadata":{},"name":"df_1","nullable":true,"type":"double"},{"metadata":{},"name":"df_2","nullable":true,"type":"double"},{"metadata":{},"name":"df_3","nullable":true,"type":"double"},{"metadata":{},"name":"df_4","nullable":true,"type":"double"},{"metadata":{},"name":"age","nullable":true,"type":"integer"},{"metadata":{},"name":"error","nullable":true,"type":"integer"},{"metadata":{"ml_attr":{"name":"label","type":"nominal","vals":["0","1"]}},"name":"label","nullable":false,"type":"double"},{"metadata":{"ml_attr":{"attrs":{"numeric":[{"idx":0,"name":"df_3"},{"idx":1,"name":"e_5"},{"idx":2,"name":"dm_4"},{"idx":3,"name":"rotate_sd_12"},{"idx":4,"name":"pressure_ma_3"},{"idx":5,"name":"m_1"},{"idx":6,"name":"rotate_ma_12"},{"idx":7,"name":"e_3"},{"idx":8,"name":"pressure_ma_12"},{"idx":9,"name":"m_4"},{"idx":10,"name":"de_1"},{"idx":11,"name":"dm_1"},{"idx":12,"name":"e_1"},{"idx":13,"name":"vibration_ma_3"},{"idx":14,"name":"de_5"},{"idx":15,"name":"vibration_sd_12"},{"idx":16,"name":"rotate_ma_3"},{"idx":17,"name":"vibration_ma_12"},{"idx":18,"name":"volt_ma_12"},{"idx":19,"name":"volt_ma_3"},{"idx":20,"name":"de_2"},{"idx":21,"name":"rotate_sd_3"},{"idx":22,"name":"df_4"},{"idx":23,"name":"age"},{"idx":24,"name":"df_1"},{"idx":25,"name":"df_2"},{"idx":26,"name":"m_3"},{"idx":27,"name":"volt_sd_12"},{"idx":28,"name":"pressure_sd_3"},{"idx":29,"name":"vibration_sd_3"},{"idx":30,"name":"pressure_sd_12"},{"idx":31,"name":"m_2"},{"idx":32,"name":"e_4"},{"idx":33,"name":"volt_sd_3"},{"idx":34,"name":"de_3"},{"idx":35,"name":"dm_2"},{"idx":36,"name":"dm_3"},{"idx":37,"name":"de_4"},{"idx":38,"name":"e_2"}]},"num_attrs":39}},"name":"features","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"rawPrediction","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"probability","nullable":true,"type":{"class":"org.apache.spark.ml.linalg.VectorUDT","pyClass":"pyspark.ml.linalg.VectorUDT","sqlType":{"fields":[{"metadata":{},"name":"type","nullable":false,"type":"byte"},{"metadata":{},"name":"size","nullable":true,"type":"integer"},{"metadata":{},"name":"indices","nullable":true,"type":{"containsNull":false,"elementType":"integer","type":"array"}},{"metadata":{},"name":"values","nullable":true,"type":{"containsNull":false,"elementType":"double","type":"array"}}],"type":"struct"},"type":"udt"}},{"metadata":{},"name":"prediction","nullable":false,"type":"double"}],"type":"struct"},"tableIdentifier":null},{"name":"output","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"volt_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"rotate_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"pressure_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"vibration_ma_3","nullable":true,"type":"double"},{"metadata":{},"name":"error","nullable":true,"type":"integer"},{"metadata":{},"name":"prediction","nullable":false,"type":"double"}],"type":"struct"},"tableIdentifier":null}],"columnCustomDisplayInfos":{}},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;F&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-3771102850754146&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">----&gt; 1</span><span class=\"ansiyellow\"> </span>selectPred <span class=\"ansiyellow\">=</span> pred<span class=\"ansiyellow\">.</span>orderBy<span class=\"ansiyellow\">(</span>F<span class=\"ansiyellow\">.</span>desc<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;prediction&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>limit<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">5</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      2</span> selectPred <span class=\"ansiyellow\">=</span> selectPred<span class=\"ansiyellow\">.</span>union<span class=\"ansiyellow\">(</span>pred<span class=\"ansiyellow\">.</span>orderBy<span class=\"ansiyellow\">(</span>F<span class=\"ansiyellow\">.</span>asc<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&apos;prediction&apos;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>limit<span class=\"ansiyellow\">(</span><span class=\"ansicyan\">5</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> output <span class=\"ansiyellow\">=</span> selectPred<span class=\"ansiyellow\">[</span><span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&apos;volt_ma_3&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;rotate_ma_3&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;pressure_ma_3&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;vibration_ma_3&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;error&apos;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&apos;prediction&apos;</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\">]</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span> display<span class=\"ansiyellow\">(</span>output<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;F&apos; is not defined</div>","workflows":[],"startTime":1547228404683,"submitTime":1547228404707,"finishTime":1547228406557,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"wopauli@microsoft.com","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c1c4e696-0475-4505-957f-db099b36aaea"},{"version":"CommandV1","origId":3771102850754147,"guid":"6d2600e3-5763-4c4c-ac7d-197337999775","subtype":"command","commandType":"auto","position":23.0,"command":"","commandVersion":0,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"82c58cd6-7576-435d-bf0d-11d4b665cd17"}],"dashboards":[],"guid":"547e5969-6985-45a1-91ef-7bde1e494048","globalVars":{},"iPythonMetadata":{"nbformat":4,"IPythonMetadata":{"language_info":{"mimetype":"text/x-python","name":"python","pygments_lexer":"ipython3","codemirror_mode":{"name":"ipython","version":3},"version":"3.7.0","nbconvert_exporter":"python","file_extension":".py"},"name":"03.Build_model_runHistory","notebookId":3836944406456339,"kernelspec":{"display_name":"Python 3.6","language":"python","name":"python36"},"authors":[{"name":"pasha"},{"name":"wamartin"}]}},"inputWidgets":{}}