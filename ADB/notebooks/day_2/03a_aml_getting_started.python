{"version":"NotebookV1","origId":4078960254878714,"name":"03a_aml_getting_started","language":"python","commands":[{"version":"CommandV1","origId":4078960254878715,"guid":"33e06144-2e36-4334-ae16-bad28706bc98","subtype":"command","commandType":"auto","position":1.0,"command":"%md # Configure your Azure Databricks (ADB) Environment\n\n## Create Azure ML Workspace","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1547602189204,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"684a922a-9422-49d4-8ec9-284ae8441dbd"},{"version":"CommandV1","origId":4078960254878716,"guid":"ab5a320c-efff-4948-be8c-b7ac37bd7e8b","subtype":"command","commandType":"auto","position":2.0,"command":"import azureml.core\n\n# Check core SDK version number - based on build number of preview/master.\nprint(\"SDK version:\", azureml.core.VERSION)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">SDK version: 1.0.8\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547602190633,"submitTime":1547602189393,"finishTime":1547602190645,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"79a090b9-9835-494c-9928-aaa749e38868"},{"version":"CommandV1","origId":4078960254878717,"guid":"7e7ac57d-1604-463e-be21-331f4bce5240","subtype":"command","commandType":"auto","position":3.0,"command":"%md Before you run the following cell, you need to fill in you `subscription_id` and your `resource_group`.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1547602189569,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"acdd7943-c1c6-406b-a80c-414bb65c2a56"},{"version":"CommandV1","origId":4078960254878718,"guid":"dfa116d7-843d-448c-9dd1-fb3fa44f5415","subtype":"command","commandType":"auto","position":4.0,"command":"subscription_id = \"423b8b2f-246b-4a88-bc52-d10c56e6ef5f\"\nresource_group = \"ODL-ml-47666\"\nworkspace_name = \"adbws\"\nworkspace_region = \"westus2\"","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1547602190649,"submitTime":1547602189590,"finishTime":1547602190659,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"079cbd2a-18c9-4e50-a642-f31f6aa13774"},{"version":"CommandV1","origId":4078960254878719,"guid":"10b1aeec-fa74-4c99-a168-63643efe4c40","subtype":"command","commandType":"auto","position":5.0,"command":"%md Running the following cell will do two things:\n1. Perform interactive authentication with Azure\n2. Create a workspace\n\n> **Important:** Make sure to pay attention to the output of the cell, because it will give you instructions about how to perform interactive authentication.  After you completed authentication, creating the workspace may take up to a minute.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1547602189784,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"425db6c3-68e3-43cd-87eb-af7ac77834a3"},{"version":"CommandV1","origId":4078960254878720,"guid":"95959c36-b8a8-4b5a-a9f5-0986da040c10","subtype":"command","commandType":"auto","position":6.0,"command":"# import the Workspace class and check the azureml SDK version\n# exist_ok checks if workspace exists or not.\n\nfrom azureml.core import Workspace\n\nws = Workspace.create(name = workspace_name,\n                      subscription_id = subscription_id,\n                      resource_group = resource_group, \n                      location = workspace_region,\n                      exist_ok=True)\n\nws.get_details()","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"><span class=\"ansired\">Out[</span><span class=\"ansired\">12</span><span class=\"ansired\">]: </span>\n{&apos;applicationInsights&apos;: &apos;/subscriptions/423b8b2f-246b-4a88-bc52-d10c56e6ef5f/resourcegroups/odl-ml-47666/providers/microsoft.insights/components/adbws4362988583&apos;,\n &apos;location&apos;: &apos;westus2&apos;,\n &apos;identityTenantId&apos;: &apos;79fe009c-79e0-4bc9-baec-a76d3145bde5&apos;,\n &apos;friendlyName&apos;: &apos;&apos;,\n &apos;identityPrincipalId&apos;: &apos;ace9e347-2c43-4a9b-b031-2f86a1ce6eca&apos;,\n &apos;identityType&apos;: &apos;SystemAssigned&apos;,\n &apos;storageAccount&apos;: &apos;/subscriptions/423b8b2f-246b-4a88-bc52-d10c56e6ef5f/resourcegroups/odl-ml-47666/providers/microsoft.storage/storageaccounts/adbws2015239730&apos;,\n &apos;keyVault&apos;: &apos;/subscriptions/423b8b2f-246b-4a88-bc52-d10c56e6ef5f/resourcegroups/odl-ml-47666/providers/microsoft.keyvault/vaults/adbws7866718552&apos;,\n &apos;creationTime&apos;: &apos;2019-01-16T01:25:31.5210294+00:00&apos;,\n &apos;name&apos;: &apos;adbws&apos;,\n &apos;id&apos;: &apos;/subscriptions/423b8b2f-246b-4a88-bc52-d10c56e6ef5f/resourceGroups/ODL-ml-47666/providers/Microsoft.MachineLearningServices/workspaces/adbws&apos;,\n &apos;containerRegistry&apos;: &apos;/subscriptions/423b8b2f-246b-4a88-bc52-d10c56e6ef5f/resourcegroups/odl-ml-47666/providers/microsoft.containerregistry/registries/adbws5411349471&apos;,\n &apos;type&apos;: &apos;Microsoft.MachineLearningServices/workspaces&apos;,\n &apos;workspaceid&apos;: &apos;e207aaa5-2d02-46c9-971c-96d3480d4a1e&apos;,\n &apos;description&apos;: &apos;&apos;}\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">AttributeError</span>: &apos;CloudError&apos; object has no attribute &apos;url&apos;","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">AttributeError</span>                            Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-3721489431276035&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      8</span>                       resource_group <span class=\"ansiyellow\">=</span> resource_group<span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      9</span>                       location <span class=\"ansiyellow\">=</span> workspace_region<span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">---&gt; 10</span><span class=\"ansiyellow\">                       exist_ok=True)\n</span><span class=\"ansigreen\">     11</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">     12</span> ws<span class=\"ansiyellow\">.</span>get_details<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/azureml/core/workspace.py</span> in <span class=\"ansicyan\">create</span><span class=\"ansiblue\">(name, auth, subscription_id, resource_group, location, create_resource_group, friendly_name, storage_account, key_vault, app_insights, container_registry, exist_ok)</span>\n<span class=\"ansigreen\">    223</span>                                         key_vault<span class=\"ansiyellow\">=</span>key_vault<span class=\"ansiyellow\">,</span> app_insights<span class=\"ansiyellow\">=</span>app_insights<span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    224</span>                                         container_registry<span class=\"ansiyellow\">=</span>container_registry<span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 225</span><span class=\"ansiyellow\">                                         exist_ok=exist_ok)\n</span><span class=\"ansigreen\">    226</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    227</span>     <span class=\"ansiyellow\">@</span>staticmethod<span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/azureml/core/workspace.py</span> in <span class=\"ansicyan\">_create_legacy</span><span class=\"ansiblue\">(auth, subscription_id, resource_group_name, workspace_name, location, create_resource_group, friendly_name, storage_account, key_vault, app_insights, container_registry, exist_ok)</span>\n<span class=\"ansigreen\">    753</span>                                                                app_insights<span class=\"ansiyellow\">=</span>app_insights<span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    754</span>                                                                containerRegistry<span class=\"ansiyellow\">=</span>container_registry<span class=\"ansiyellow\">,</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 755</span><span class=\"ansiyellow\">                                                                exist_ok=exist_ok)\n</span><span class=\"ansigreen\">    756</span>         <span class=\"ansigreen\">if</span> <span class=\"ansigreen\">not</span> workspace_object_autorest<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    757</span>             <span class=\"ansigreen\">raise</span> WorkspaceException<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;Couldn&apos;t create the workspace.&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/azureml/_project/_commands.py</span> in <span class=\"ansicyan\">create_workspace</span><span class=\"ansiblue\">(auth, resource_group_name, workspace_name, subscription_id, location, create_resource_group, friendly_name, storage_account, key_vault, app_insights, containerRegistry, exist_ok)</span>\n<span class=\"ansigreen\">    239</span>         <span class=\"ansigreen\">else</span><span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    240</span>             <span class=\"ansigreen\">from</span> azureml<span class=\"ansiyellow\">.</span>_base_sdk_common<span class=\"ansiyellow\">.</span>common <span class=\"ansigreen\">import</span> get_http_exception_response_string<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 241</span><span class=\"ansiyellow\">             </span><span class=\"ansigreen\">raise</span> WorkspaceException<span class=\"ansiyellow\">(</span>get_http_exception_response_string<span class=\"ansiyellow\">(</span>e<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    242</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    243</span>     <span class=\"ansigreen\">if</span> <span class=\"ansigreen\">not</span> found<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansigreen\">/databricks/python/lib/python3.5/site-packages/azureml/_base_sdk_common/common.py</span> in <span class=\"ansicyan\">get_http_exception_response_string</span><span class=\"ansiblue\">(http_response)</span>\n<span class=\"ansigreen\">    453</span>     &quot;&quot;&quot;\n<span class=\"ansigreen\">    454</span>     error_dict <span class=\"ansiyellow\">=</span> dict<span class=\"ansiyellow\">(</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">--&gt; 455</span><span class=\"ansiyellow\">     </span>error_dict<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&quot;url&quot;</span><span class=\"ansiyellow\">]</span> <span class=\"ansiyellow\">=</span> http_response<span class=\"ansiyellow\">.</span>url<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    456</span>     error_dict<span class=\"ansiyellow\">[</span><span class=\"ansiblue\">&quot;status_code&quot;</span><span class=\"ansiyellow\">]</span> <span class=\"ansiyellow\">=</span> http_response<span class=\"ansiyellow\">.</span>status_code<span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">    457</span>     <span class=\"ansigreen\">if</span> http_response<span class=\"ansiyellow\">.</span>text<span class=\"ansiyellow\">:</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">AttributeError</span>: &apos;CloudError&apos; object has no attribute &apos;url&apos;</div>","workflows":[],"startTime":1547602190662,"submitTime":1547602189815,"finishTime":1547602191329,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f3d3a0c2-1baa-4dbf-b5be-ba9b8eeb7ff1"},{"version":"CommandV1","origId":4078960254878721,"guid":"7ff1899a-c0e0-4417-83e9-8d071a2df7ca","subtype":"command","commandType":"auto","position":7.0,"command":"%md Confirm that the workspace has been created successfully, and if so, we write the configuration to json file (`config.json`) for later use.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1547602189973,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"e9a51a37-ba52-4130-800a-59a869ab6031"},{"version":"CommandV1","origId":4078960254878722,"guid":"c82f3a45-ba49-4da5-a7db-4abedae03262","subtype":"command","commandType":"auto","position":8.0,"command":"ws = Workspace(workspace_name = workspace_name,\n               subscription_id = subscription_id,\n               resource_group = resource_group)\n\nconfig_path='/dbfs/tmp/'\n\n# persist the subscription id, resource group name, and workspace name in aml_config/config.json.\nws.write_config(path=config_path)","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Wrote the config file config.json to: /dbfs/tmp/aml_config/config.json\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1547602191333,"submitTime":1547602190142,"finishTime":1547602192230,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"610dc643-4f8c-4f9e-8a49-961edfdbc8d6"},{"version":"CommandV1","origId":4078960254878723,"guid":"e1639c81-0669-4e8f-8fd5-ac9c9fa527df","subtype":"command","commandType":"auto","position":9.0,"command":"%md Confirm that it is possible to create the workspacce from the `config.json` file we created above.","commandVersion":1,"state":"finished","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":1547602190287,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"a1211291-5541-4b4f-8605-29870aaa04c7"},{"version":"CommandV1","origId":4078960254878724,"guid":"c31732c6-e784-4489-935f-c91236df42e0","subtype":"command","commandType":"auto","position":10.0,"command":"from azureml.core.workspace import Workspace\nimport os\n\nws = Workspace.from_config(path=os.path.join(config_path, 'aml_config','config.json'))\n\nprint('Workspace name: ' + ws.name, \n      'Azure region: ' + ws.location, \n      'Subscription id: ' + ws.subscription_id, \n      'Resource group: ' + ws.resource_group, sep = '\\n')","commandVersion":1,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\">Found the config file in: /dbfs/tmp/aml_config/config.json\nWorkspace name: adbws\nAzure region: westus2\nSubscription id: 423b8b2f-246b-4a88-bc52-d10c56e6ef5f\nResource group: ODL-ml-47666\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"Command skipped","error":null,"workflows":[],"startTime":1547602192234,"submitTime":1547602190595,"finishTime":1547602192744,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"odl_user_47666@msazurehol.onmicrosoft.com","latestUserId":"5858075836730959","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b61a2c16-b67d-464a-a549-e5be8634ce15"}],"dashboards":[],"guid":"aef702b6-84d5-48e6-8b82-fd2df138c220","globalVars":{},"iPythonMetadata":{"nbformat":4,"IPythonMetadata":{"kernelspec":{"display_name":"Python [default]","language":"python","name":"python3"},"language_info":{"mimetype":"text/x-python","name":"python","pygments_lexer":"ipython3","codemirror_mode":{"name":"ipython","version":3},"version":"3.5.5","nbconvert_exporter":"python","file_extension":".py"},"name":"configure_environment_ADB","notebookId":1951564739234054}},"inputWidgets":{}}